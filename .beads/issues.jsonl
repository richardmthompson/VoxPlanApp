{"id":"VoxPlanApp-07g","title":"Missing error handling in repository operations","description":"Repository and DAO operations have minimal error handling. Only 6 try-catch blocks in entire codebase (AppContainer.kt, FocusViewModel.kt). Database operations can fail (disk full, corruption, migration errors). Add proper error handling with user-facing error states.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:40:04.653046+07:00","updated_at":"2025-12-26T19:22:34.424878+07:00","closed_at":"2025-12-26T19:22:34.424878+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-0r0","title":"Material 3 Incremental Migration","description":"Migrate VoxPlanApp to Material 3 theme system incrementally. Phase 1: Enable light mode theme infrastructure. Phase 2: Pilot with Progress screen. Phase 3: Full dark mode migration of all screens.","notes":"**STATUS**: POST_MVP - Blocked by VoxPlanApp-xyx (MVP Release)\n\n**PLANNING COMPLETED**:\n- ✅ Phase 1 PRP: .claude/PRPs/enable-material3-theme-light.md (627 lines, 8/10 confidence)\n- ✅ Phase 2 Scratchpad: scratchpad/2025-12-26-162146_progress-screen-theme-migration/plan.md\n- ✅ Supporting AI Docs: material3_color_system.md (914 lines), voxplan_color_mapping_template.md (363 lines)\n- ✅ Context Updated: agent/context/material3_context.md\n\n**DEPENDENCIES**:\n- VoxPlanApp-zhn → VoxPlanApp-bln → VoxPlanApp-yuo (sequential phases)\n- All blocked by VoxPlanApp-xyx (MVP Release must complete first)\n\n**KEY DECISIONS**:\n- Incremental migration approach (not all-at-once)\n- Light mode first, dark mode Phase 3\n- Progress screen as pilot to validate approach\n- Extended colors (medals, power bars) via CompositionLocal pattern\n- Dynamic colors disabled for brand consistency\n\n**NEXT STEPS** (when MVP complete):\n1. Implement VoxPlanApp-zhn (enable theme infrastructure)\n2. Test with VoxPlanApp-bln (Progress screen migration)\n3. Roll out VoxPlanApp-yuo (full dark mode + all screens)","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-26T20:39:28.325478+07:00","updated_at":"2025-12-26T20:41:38.160554+07:00","dependencies":[{"issue_id":"VoxPlanApp-0r0","depends_on_id":"VoxPlanApp-xyx","type":"blocks","created_at":"2025-12-26T20:41:37.436516+07:00","created_by":"daemon"}]}
{"id":"VoxPlanApp-0tl","title":"Fix Focus Mode state loss bug on process death","description":"Users lose timer progress (elapsed time, medals, timer state) when Android kills the app process during extended backgrounding. Root cause: FocusViewModel uses mutableStateOf which doesn't survive process death. Solution: Use SavedStateHandle (already injected at line 40) to persist critical timer state across process death.\n\nImplementation plan: /Users/richardthompson/StudioProjects/VoxPlanApp/.claude/scratchpad/2025-12-22_focus-mode-state-loss-bug.md\n\nFiles affected: FocusViewModel.kt (only file)\nEstimated: 2-3 hours, ~150 lines of code","design":"Use SavedStateHandle to persist timer state (currentTime, timerState, timerStarted, medals) to Bundle. Android automatically serializes SavedStateHandle during onSaveInstanceState() when Activity backgrounds. Restore state in ViewModel init if saved state exists (single check). Clear saved state on normal exit/banking. Follows Android best practices: update SavedStateHandle continuously (cheap in-memory writes), Android handles serialization timing automatically.","acceptance_criteria":"- [ ] Timer state (elapsed time) survives process death after 5+ min backgrounding\n- [ ] Medals persist across process death\n- [ ] Timer that was RUNNING auto-pauses on restoration with correct time\n- [ ] Banked/exited sessions start fresh (no stale state restoration)\n- [ ] No Bundle size exceptions (TransactionTooLargeException)\n- [ ] All validation tests pass (see scratchpad Success Definition)","notes":"## PARTIALLY COMPLETE - STALE STATE BUG DISCOVERED\n\n**Implementation Summary:**\nAdded SavedStateHandle persistence to FocusViewModel. State DOES save and restore, but with STALE values.\n\n**What Works:**\n✅ SavedStateHandle constants added\n✅ restoreSavedState() implemented with single-check pattern\n✅ saveCurrentState() called from timer functions + every 5 seconds\n✅ clearSavedState() on exit/banking\n✅ State saves while backgrounded (logs confirm)\n✅ State restores after process death\n\n**Critical Bug Found (NEW ISSUE: VoxPlanApp-q6l):**\n❌ Restored state uses OLD values from initial backgrounding, not latest saved values\n- Background with medals=2 → Process death → Restores medals=1\n- SavedStateHandle writes happening but Android restoring stale Bundle\n\n**Test Evidence:**\nLog shows: Saved state medals=2, but Restored state medals=1 (should be 2)\n\n**Files Modified:** FocusViewModel.kt\n**New Investigation Needed:** See VoxPlanApp-q6l for SavedStateHandle stale state bug","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T16:13:03.459494+07:00","updated_at":"2025-12-22T21:01:42.893934+07:00","closed_at":"2025-12-22T16:20:48.184647+07:00","close_reason":"Implementation complete. Added SavedStateHandle persistence to FocusViewModel following Android best practices. Timer state (elapsed time, medals, timer state) now survives process death. Code compiles successfully. Ready for testing."}
{"id":"VoxPlanApp-1zb","title":"Fix 'Add Quota Tasks' duplication bug","description":"Add Quota Tasks button creates duplicate entries when clicked multiple times. Should only add quota tasks that aren't already visible in dailies list. If user deletes some quota tasks and clicks button again, only re-add the deleted ones.","design":"Add duplicate check in addQuotaTasks() function (DailyViewModel.kt:112-137). Filter quotas against existing dailyTasks by goalId before inserting Events.","acceptance_criteria":"- [ ] Build succeeds\n- [ ] Clicking 'Add Quotas' multiple times doesn't create duplicates\n- [ ] Deleting quota tasks and clicking 'Add Quotas' only re-adds deleted ones\n- [ ] Clicking 'Add Quotas' when all quotas exist does nothing","notes":"COMPLETED:\n- Added duplicate check to addQuotaTasks() function (DailyViewModel.kt:112-143)\n  - Added line 117: val existingDailyTasks = uiState.value.dailyTasks\n  - Added lines 121-122: Check if quota task already exists by goalId\n  - Wrapped Event creation in 'if (!alreadyExists)' block (line 124)\n  - Updated comment on line 119 to clarify new behavior\n- Build successful: ./gradlew assembleDebug completed with no compilation errors\n- Net change: +4 lines (added duplicate filtering logic)\n\nIMPLEMENTATION DETAILS:\n- Filter logic: existingDailyTasks.any { it.goalId == quota.goalId }\n- Button is now idempotent - clicking multiple times won't create duplicates\n- If user deletes quota tasks and clicks button again, only re-adds deleted ones\n- If all quota tasks already exist, button does nothing (no-op)\n\nVERIFICATION STATUS:\n- ✅ Build succeeds without errors\n- ⏳ Manual testing pending (requires device/emulator)\n\nMANUAL TESTING CHECKLIST:\n1. Click 'Add Quotas' button → Verify quota tasks added\n2. Click 'Add Quotas' again → Verify no duplicates created\n3. Delete 2 quota tasks → Click 'Add Quotas' → Verify only 2 deleted tasks re-added\n4. Click 'Add Quotas' when all quotas exist → Verify no change/no errors\n\nFILES MODIFIED:\n- app/src/main/java/com/voxplanapp/ui/daily/DailyViewModel.kt","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T17:42:25.329724+07:00","updated_at":"2025-12-20T17:43:28.241858+07:00","closed_at":"2025-12-20T17:43:28.241858+07:00","close_reason":"Code complete - build successful. Duplicate check implemented. Manual testing pending on device/emulator."}
{"id":"VoxPlanApp-2a6","title":"QuickScheduleScreen.kt entirely commented out - remove or implement","description":"QuickScheduleScreen.kt (lines 26-86) is entirely commented out with undefined variables ('goal' not in scope). Either implement properly or delete the dead code file. Location: ui/main/QuickScheduleScreen.kt","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T18:39:38.570197+07:00","updated_at":"2025-12-26T19:22:34.427128+07:00","closed_at":"2025-12-26T19:22:34.427128+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-2ij","title":"DaySchedule.kt delete dialog uses undefined variable","description":"Critical bug: Lines 110-126 in DaySchedule.kt have a commented-out AlertDialog that references undefined 'event' variable. The showDeleteParentDialog state exists but dialog implementation is broken. Fix: refactor to use showDeleteParentDialog.value (the Event) instead of undefined 'event'.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T18:39:26.790873+07:00","updated_at":"2025-12-26T19:22:34.423805+07:00","closed_at":"2025-12-26T19:22:34.423805+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-2jx","title":"103 Log statements in production code - cleanup needed","description":"103 Log.d/e/w calls across 17 files. While some logging is useful, excessive logging in production can impact performance and expose implementation details. Consider: 1) Remove debug-only logs, 2) Use BuildConfig.DEBUG guards, 3) Implement proper logging framework with log levels.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T18:39:24.81295+07:00","updated_at":"2025-12-26T19:22:34.427615+07:00","closed_at":"2025-12-26T19:22:34.427615+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-37e","title":"Missing foreign key constraint between Event and TodoItem","description":"Event.goalId references TodoItem.id but has no FK constraint. Quota has proper FK with CASCADE, but Event doesn't. This can lead to orphaned events if a goal is deleted. Add: FOREIGN KEY (goalId) REFERENCES TodoItem(id) ON DELETE CASCADE","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:40:28.945745+07:00","updated_at":"2025-12-26T19:22:34.424197+07:00","closed_at":"2025-12-26T19:22:34.424197+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-3cf","title":"Fix Focus Mode dailies duplication bug","description":"Remove automatic Event creation from Focus Mode that pollutes Dailies list. Preserve TimeBank tracking for ad-hoc sessions and Event updates for scheduled sessions. See plan: .claude/scratchpad/focus-mode-dailies-bug/plan.md","design":"Delete Event creation blocks from FocusViewModel.kt: bankTime() lines 470-483 and createOrUpdateEvent() lines 524-538. Keep TimeBank tracking, keep scheduled event updates.","acceptance_criteria":"- [ ] Build succeeds (./gradlew assembleDebug)\n- [ ] Ad-hoc Focus Mode does NOT create Dailies entries\n- [ ] Banking medals does NOT create Dailies entries  \n- [ ] TimeBank entries still created correctly\n- [ ] Scheduled event updates still work when isFromEvent=true","notes":"COMPLETED:\n- Removed Event creation from bankTime() function (FocusViewModel.kt:470-483)\n  - Kept TimeBank tracking (source of truth for ad-hoc focus time)\n  - Removed redundant Event insertion that caused Dailies pollution\n- Removed ad-hoc Event creation from createOrUpdateEvent() (FocusViewModel.kt:524-538)\n  - Preserved scheduled event updates (when isFromEvent=true)\n  - Added clarifying comment about TimeBank-only tracking for ad-hoc sessions\n- Build successful: ./gradlew assembleDebug completed with no compilation errors\n- Net change: -23 lines (removed ~29, added ~6 in comments)\n\nVERIFICATION STATUS:\n- ✅ Build succeeds without errors\n- ✅ TimeBank tracking preserved (line 469)\n- ✅ Scheduled event updates preserved (lines 501-509)\n- ⏳ Manual testing pending (requires device/emulator)\n\nMANUAL TESTING CHECKLIST (from plan.md lines 442-468):\n1. Test ad-hoc Focus Mode from MainScreen → verify no Dailies entries created\n2. Test banking medals → verify no Dailies entries created\n3. Test scheduled event update → verify Event times updated correctly\n4. Verify TimeBank entries still created for progress tracking\n\nFILES MODIFIED:\n- app/src/main/java/com/voxplanapp/ui/focusmode/FocusViewModel.kt","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T17:19:45.923544+07:00","updated_at":"2025-12-20T17:42:24.114207+07:00","closed_at":"2025-12-20T17:42:24.114207+07:00","close_reason":"Code complete - build successful. Manual testing pending on device/emulator."}
{"id":"VoxPlanApp-3pw","title":"Improve medal count multiplier styling","description":"Make the (×3) text below medals bigger, bold, and gold colored to emphasize the multiplier value","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T20:22:03.937454+07:00","updated_at":"2025-12-26T20:25:58.9231+07:00","closed_at":"2025-12-26T20:25:58.9231+07:00","close_reason":"Styled multiplier text: bodyLarge, bold, gold (#FFD700)"}
{"id":"VoxPlanApp-3sr","title":"Hide Dailies and Schedule from MVP","description":"Hide Dailies and Schedule features from bottom navigation without deleting code. Comment out nav items in VoxPlanApp.kt to show only Goals and Progress for MVP release. See plan: .claude/scratchpad/2025-12-22-hide-dailies-schedule/plan.md","acceptance_criteria":"- [ ] Build succeeds\n- [ ] Bottom nav shows only Goals and Progress (2 items)\n- [ ] Can navigate between Goals and Progress\n- [ ] No Daily or Schedule tabs visible\n- [ ] All code preserved (no files deleted)","notes":"COMPLETED:\n- Commented out Daily nav item (VoxPlanApp.kt:251-257)\n- Commented out Schedule nav item (VoxPlanApp.kt:264-270)\n- Added 'HIDDEN FOR MVP - Re-enable post-launch' comments for clarity\n- Build successful: ./gradlew assembleDebug completed with no errors\n\nIMPLEMENTATION DETAILS:\n- Modified VoxPlanApp.kt lines 244-271\n- Bottom nav items reduced from 4 → 2 (Goals, Progress)\n- All Dailies/Schedule code preserved (ViewModels, Screens, Routes intact)\n- Zero code deletion - 100% reversible by uncommenting\n\nVERIFICATION STATUS:\n- ✅ Build succeeds without errors\n- ✅ Only pre-existing warnings (unrelated to changes)\n- ⏳ Manual testing pending (requires device/emulator)\n\nMANUAL TESTING CHECKLIST:\n1. Launch app → Verify only 2 bottom nav items visible (Goals, Progress)\n2. Navigate Goals → Progress → Goals → Verify smooth transitions\n3. Verify no Daily or Schedule tabs visible\n4. Test core flow: Create goal → FocusMode → Bank time → Progress\n\nRE-ENABLEMENT:\nTo restore Dailies/Schedule: Uncomment lines 251-257 and 264-270 in VoxPlanApp.kt\nEstimated time to re-enable: 2 minutes\n\nFILES MODIFIED:\n- app/src/main/java/com/voxplanapp/navigation/VoxPlanApp.kt (1 file)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T14:09:56.870249+07:00","updated_at":"2025-12-22T14:11:19.032337+07:00","closed_at":"2025-12-22T14:11:19.032337+07:00","close_reason":"Code complete - build successful. Bottom navigation now shows only Goals and Progress for MVP. All Dailies/Schedule code preserved. Manual testing pending on device/emulator."}
{"id":"VoxPlanApp-4zx","title":"runBlocking on UI thread in GoalEditScreen - potential ANR","description":"GoalEditScreen.kt:94 uses 'runBlocking { viewModel.getParentGoalTitle() }' on the main thread. This blocks the UI thread and can cause ANR. Fix: Use LaunchedEffect or make it a StateFlow that's collected asynchronously.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T18:39:39.685406+07:00","updated_at":"2025-12-26T19:22:34.423131+07:00","closed_at":"2025-12-26T19:22:34.423131+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-6q2","title":"Progress screen title bar theming improvements","description":"Full-width title bar with darker turquoise background, improved color scheme based on Material3 principles. See plan: scratchpad/progress-title-bar-theming_26-Dec-25/plan.md","notes":"COMPLETED:\n- Added TertiaryDarkColor = Color(0xFF2C5F61) to Colors.kt:13 - darker turquoise variant (~60% darker than original)\n- Added ProgressScreenBackgroundColor = Color(0xFFF0F8F8) to Colors.kt:17 - extracted light cyan background to constant\n- Updated ProgressScreen title bar (lines 71-84):\n  * Removed RoundedCornerShape for full-width edge-to-edge appearance\n  * Changed background from TertiaryColor to TertiaryDarkColor (darker, more sophisticated)\n  * Simplified padding to single .padding(vertical = 16.dp, horizontal = 16.dp)\n  * Added color = Color.White to title text for contrast on dark background\n- Updated ProgressScreen Column background (line 67) to use ProgressScreenBackgroundColor constant\n- Added imports for ProgressScreenBackgroundColor and TertiaryDarkColor\n- Build successful with no compilation errors\n\nIN PROGRESS: None\n\nBLOCKERS: None\n\nKEY DECISIONS:\n- Used Material3 color theory principles (tonal palette, HSL-based darkening) to create TertiaryDarkColor\n- Chose 0xFF2C5F61 as darker variant: reduces RGB proportionally while maintaining hue\n- Removed rounded corners entirely for modern full-width app bar look\n- Added white text color for WCAG-compliant contrast on dark background\n- Created new TertiaryDarkColor constant instead of modifying TertiaryColor - prevents breaking other screens (Goals, Daily)\n- Extracted background color to constant for reusability and easier future changes\n\nFiles modified:\n- Colors.kt: 3 lines added (2 new color constants)\n- ProgressScreen.kt: 8 lines changed (title bar styling, background constant, imports)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T23:36:27.089353+07:00","updated_at":"2025-12-26T23:38:38.826482+07:00","closed_at":"2025-12-26T23:38:38.826482+07:00","close_reason":"Closed"}
{"id":"VoxPlanApp-7gu","title":"Process death: medals don't accrue when existing medals present","description":"When app is backgrounded/killed with existing medals, new medals don't accrue on restore. Works correctly when starting from 0 medals.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T20:27:50.32758+07:00","updated_at":"2025-12-26T20:30:35.305342+07:00","closed_at":"2025-12-26T20:30:35.305342+07:00","close_reason":"Fixed: startTimestamp is reset after each medal, so completeRevolutions already represents NEW revolutions - removed incorrect subtraction of existingMedals.size"}
{"id":"VoxPlanApp-7q0","title":"No unit tests - only 2 example tests exist","description":"Critical test coverage gap. Only ExampleUnitTest.kt and ExampleInstrumentedTest.kt exist with 1 @Test each. Priority tests to write: 1) SharedViewModel.processGoals() hierarchy logic, 2) TodoRepository transaction operations, 3) Event parent-child relationships, 4) FocusViewModel timer state management, 5) Database migrations 12-\u003e13.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:39:50.935611+07:00","updated_at":"2025-12-26T19:22:34.425782+07:00","closed_at":"2025-12-26T19:22:34.425782+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-7v1","title":"Streamline Beads Notes Structure section in CLAUDE.md","description":"The Beads Notes Structure section is overly detailed with redundant examples and explanations that could be more concise.","design":"Simplify to:\n- Keep the structured format (COMPLETED/IN PROGRESS/BLOCKERS/KEY DECISIONS)\n- Reduce to 1 good/bad example per section instead of multiple\n- Consolidate quality tests into a single guideline\n- Remove redundant 'When to Update Notes' list (obvious from context)\n- Keep only essential characteristics","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T23:08:37.178122+07:00","updated_at":"2025-12-22T23:19:27.930894+07:00","closed_at":"2025-12-22T23:19:27.930894+07:00","close_reason":"Section already streamlined to 18 lines (189-206). Consolidated quality tests into single test, removed redundant 'When to Update Notes' list, kept only essential guidelines with inline examples."}
{"id":"VoxPlanApp-8ja","title":"Bug: Second discrete task click doesn't show animation or award medal","description":"When using discrete task mode (clicking clockface to add specific minutes):\n1. First click works correctly - shows counting-up graphic, awards medal\n2. Second click fails - no counting-up graphic displayed, no medal awarded\n3. Bug occurs consistently on second discrete task addition\n\nThis breaks the discrete task workflow where users want to log multiple discrete tasks in sequence.\n\nExpected: Each clockface click should show animation and award appropriate medal\nActual: Only first click works, subsequent clicks fail silently\n\nUser workflow affected: Multiple discrete task logging in same Focus Mode session","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T16:23:51.177111+07:00","updated_at":"2025-12-26T16:51:31.633283+07:00","closed_at":"2025-12-26T16:51:31.633283+07:00","close_reason":"Fixed: discreteTaskState now always resets to IDLE after stopDiscreteTask(), allowing subsequent discrete task clicks to work properly"}
{"id":"VoxPlanApp-a6t","title":"Condense Beads Issue Fields Overview in CLAUDE.md","description":"The Beads Issue Fields Overview section contains redundant information that can be represented more efficiently. The table and field descriptions repeat the same information multiple times.","design":"Convert to a more compact format:\n- Keep the table but make it more concise\n- Consolidate 'Field Usage Guidelines' into 1-2 sentences per field\n- Remove redundant examples that don't add value\n- Keep only the most critical usage patterns\n- Eliminate 'Common mistakes' section or merge into field descriptions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T23:08:35.095759+07:00","updated_at":"2025-12-22T23:19:01.893645+07:00","closed_at":"2025-12-22T23:19:01.893645+07:00","close_reason":"Section already condensed from 60 to 15 lines (172-186). Table streamlined with 4 columns, field usage reduced to bullet points with 1 example each."}
{"id":"VoxPlanApp-ab1","title":"MainViewModel moveToSuper has race condition with async getRootTodos","description":"MainViewModel.kt:350-354: viewModelScope.launch for getRootTodos() but immediately uses targetGoalList on line 357 before launch completes. targetGoalList will be empty. Fix: await the result or restructure flow.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T18:40:16.557015+07:00","updated_at":"2025-12-26T19:22:34.424549+07:00","closed_at":"2025-12-26T19:22:34.424549+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-bln","title":"Migrate Progress screen to Material 3 theme","description":"Replace 9 hardcoded colors in ProgressScreen.kt with MaterialTheme.colorScheme semantic roles. Maintains visual design (today/past/future differentiation). Validates theme infrastructure works. Scratchpad: scratchpad/2025-12-26-162146_progress-screen-theme-migration/plan.md. Effort: 1 hour. Depends on: VoxPlanApp-zhn (theme infrastructure must be enabled first).","notes":"**STATUS**: POST_MVP - Blocked by VoxPlanApp-zhn (theme infrastructure) AND VoxPlanApp-xyx (MVP Release)\n\n**PLANNING COMPLETE**:\n- Scratchpad: scratchpad/2025-12-26-162146_progress-screen-theme-migration/plan.md\n- 5-step implementation plan with exact file:line changes\n- Visual test plan (6 steps)\n\n**DELIVERABLES**:\n- Replace 9 hardcoded Color() instances in ProgressScreen.kt\n- Card backgrounds: tertiaryContainer, secondaryContainer, surfaceContainerHigh\n- Borders: primary, secondary (75% alpha), outline\n- Text: primary, onSurface, onSurfaceVariant\n- Maintain today/past/future visual differentiation\n\n**BLOCKERS**: \n- VoxPlanApp-zhn (theme infrastructure must be enabled first)\n- VoxPlanApp-xyx (MVP Release) - POST_MVP work\n\n**KEY DECISIONS**:\n- Follow existing pattern in same file (lines 247-403)\n- Use .copy(alpha = 0.75f) for past border transparency\n- Defer star colors to extended colors (separate task)\n- Skip commented WeeklySummary code (lines 87-155)\n\n**VALIDATION**:\n- Build succeeds\n- Visual test: today/past/future cards render correctly\n- State differentiation remains clear\n- No color regressions\n\n**EFFORT**: 1 hour\n**CONFIDENCE**: High (pattern exists in same file, self-contained)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T20:39:50.783641+07:00","updated_at":"2025-12-26T20:42:09.944378+07:00","dependencies":[{"issue_id":"VoxPlanApp-bln","depends_on_id":"VoxPlanApp-zhn","type":"blocks","created_at":"2025-12-26T20:40:06.823436+07:00","created_by":"daemon"}]}
{"id":"VoxPlanApp-cbj","title":"Deprecated API: consumeAllChanges in DaySchedule.kt","description":"DaySchedule.kt:50 imports deprecated 'consumeAllChanges'. Replace with 'consume()' which is the modern Compose pointer input API. Location: ui/calendar/DaySchedule.kt:50","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T18:39:52.304553+07:00","updated_at":"2025-12-26T19:22:34.426612+07:00","closed_at":"2025-12-26T19:22:34.426612+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-ccs","title":"Bug: Changing revolution setting only awards 1 medal regardless of elapsed time","description":"When changing revolution time (e.g., from 3min to 1min), only 1 medal is awarded even if elapsed time would earn multiple medals at the new setting. E.g., at 2 minutes elapsed, switching to 1min revolution should award 2 medals but only awards 1.","notes":"ROOT CAUSE IDENTIFIED:\nupdateClockFaceMinutes() at FocusViewModel.kt:491-494 doesn't calculate medals owed at new setting.\n\nPROBLEM: Function simply saves new setting without awarding medals for elapsed time.\n\nFIX: Add logic to:\n1. Calculate elapsed time from startTimestamp\n2. Determine medals at NEW revolution setting\n3. Award those medals\n4. Reset timer with remainder\n5. Update startTimestamp\n\nCONFIDENCE: High - straightforward enhancement to existing function.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-26T16:21:24.287457+07:00","updated_at":"2025-12-26T16:48:47.156783+07:00","closed_at":"2025-12-26T16:48:47.156783+07:00","close_reason":"Fixed in FocusViewModel.kt: (1) Medal calculation now only counts new revolutions during process death, (2) startTimestamp corrected after restore, (3) Revolution change now awards correct medals based on elapsed time"}
{"id":"VoxPlanApp-djm","title":"Duplicate migration logic in MIGRATION_6_7 and MIGRATION_7_8","description":"AppDatabase.kt migrations 6-\u003e7 and 7-\u003e8 have identical code creating TimeBank table. This suggests a migration was duplicated by mistake. Review migration history and consolidate if needed.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T18:40:27.871947+07:00","updated_at":"2025-12-26T19:22:34.426223+07:00","closed_at":"2025-12-26T19:22:34.426223+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-eey","title":"Bug: Timer resets to 0 after process death medal award","description":"After process death recovery awards medals, timer resets to 0 instead of showing correct remaining time. E.g., if at 7 minutes on 5-minute revolution, should show 2 minutes remaining after awarding medal.","notes":"ROOT CAUSE IDENTIFIED:\nAfter awarding process-death medals, startTimestamp isn't updated to account for medal time.\n\nLOCATION: FocusViewModel.kt:179 and timestamp management in restoreSavedState()\n\nPROBLEM: Timer continues from original start timestamp, causing incorrect remainder calculation.\n\nFIX: After awarding recovery medals, update startTimestamp:\n  val newStartTimestamp = startTimestamp + (allMedals.size * revolutionMillis.toLong())\n  savedStateHandle[KEY_START_TIMESTAMP] = newStartTimestamp\n\nCONFIDENCE: High - related to Bug 1, same code path.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T16:21:22.451365+07:00","updated_at":"2025-12-26T16:48:47.148347+07:00","closed_at":"2025-12-26T16:48:47.148347+07:00","close_reason":"Fixed in FocusViewModel.kt: (1) Medal calculation now only counts new revolutions during process death, (2) startTimestamp corrected after restore, (3) Revolution change now awards correct medals based on elapsed time"}
{"id":"VoxPlanApp-ft7","title":"Streamline TodoWrite vs Beads section in CLAUDE.md","description":"The TodoWrite vs Beads section in CLAUDE.md is unnecessarily verbose and can be made more concise while retaining the essential information about when to use each tool.","design":"Condense the section to focus on key decision criteria:\n- Timescale distinction (minutes-hours vs days-weeks)\n- Persistence across sessions\n- Use simple table format for comparison\n- Keep handoff pattern example but make it more concise\n- Remove redundant explanations and examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T23:08:33.632832+07:00","updated_at":"2025-12-22T23:18:15.69792+07:00","closed_at":"2025-12-22T23:18:15.69792+07:00","close_reason":"Section already streamlined to 16 lines (153-168) with table format, key decision statement, and concise handoff pattern. No further condensing needed."}
{"id":"VoxPlanApp-gbv","title":"Unused import in TodoDao.kt","description":"TodoDao.kt:4 imports 'androidx.compose.ui.input.pointer.PointerId' which is a Compose UI class that has no place in a Room DAO interface. Remove the unused import.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-26T18:40:43.587564+07:00","updated_at":"2025-12-26T19:22:34.42885+07:00","closed_at":"2025-12-26T19:22:34.42885+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-ghk","title":"Migrate MainScreen gamification UI to Material 3 theme","description":"Replace all hardcoded Color(0xFF...) values in MainScreen.kt PowerBar/Diamond/OneBar components with Material 3 theme accessors. Add missing extended colors (diamond, coin, oneBar states) to ExtendedColors.kt. Wrap VoxPlanApp in VoxPlanAppTheme to enable theme. No visual changes - refactoring only.","notes":"[2025-12-26 17:02 UTC] Checkpoint - MainScreen Migration COMPLETED\n\nCOMPLETED:\n- Migrated all 12 hardcoded colors in MainScreen.kt to Material 3 theme system\n- Added 7 new extended colors to ExtendedColors.kt (diamondFill, diamondBorder, coinBorder, oneBarBorderFull, oneBarBorderPartial, oneBarFillFull, oneBarFillEmpty)\n- Fixed missing import: com.voxplanapp.ui.theme.extendedColors (MainScreen.kt:60)\n- Fixed OneBar empty fill: was using MaterialTheme.colorScheme.error (0xFFB3261E dark red), corrected to extendedColors.oneBarFillEmpty (0xFFFF0000 bright red)\n- **CRITICAL FIX**: Wrapped VoxPlanApp() in VoxPlanAppTheme{} (VoxPlanApp.kt:91) - without this, ALL extended colors returned Color.Unspecified (transparent)\n- All 12 colors verified to match original hex values exactly\n- Build successful (9s)\n\nFILES MODIFIED:\n- app/src/main/java/com/voxplanapp/ui/theme/ExtendedColors.kt (+7 colors, lines 30-41, 68-80)\n- app/src/main/java/com/voxplanapp/ui/main/MainScreen.kt (+1 import, 12 color replacements)\n- app/src/main/java/com/voxplanapp/navigation/VoxPlanApp.kt (added VoxPlanAppTheme wrapper, line 91)\n\nCOMMITS (feature/mainscreen-material3-clean):\n- 622b14e: Initial Material 3 migration\n- 9514df2: Fix missing import\n- e1ca280: Fix OneBar empty fill color\n- 62ecbd8: CRITICAL - Wrap app in VoxPlanAppTheme\n\nCOLOR VERIFICATION TABLE:\n| Component | Element | Original | Theme Accessor | Hex | Status |\n|-----------|---------|----------|----------------|-----|--------|\n| PowerBar | Row background | Color.Black | MaterialTheme.colorScheme.scrim | 0xFF000000 | ✅ |\n| PowerBar | \"POWER:\" text | Color(0xFFFF5722) | extendedColors.quotaProgress | 0xFFFF5722 | ✅ |\n| PowerBar | Diamond multiplier | Color(0xFF4CAF50) | extendedColors.powerBarFill | 0xFF4CAF50 | ✅ |\n| PowerBar | Coin background | Color(0xFFFFD700) | extendedColors.medalGold | 0xFFFFD700 | ✅ |\n| PowerBar | Coin border | Color(0xFFFF9800) | extendedColors.coinBorder | 0xFFFF9800 | ✅ |\n| PowerBar | Coin text | Color.Black | MaterialTheme.colorScheme.scrim | 0xFF000000 | ✅ |\n| Diamond | Fill | Color(0xFF9C27B0) | extendedColors.diamondFill | 0xFF9C27B0 | ✅ |\n| Diamond | Border | Color(0xFFBA68C8) | extendedColors.diamondBorder | 0xFFBA68C8 | ✅ |\n| OneBar | Border (full) | Color(0xFF1BA821) | extendedColors.oneBarBorderFull | 0xFF1BA821 | ✅ |\n| OneBar | Border (partial) | Color(0xFF3F51B5) | extendedColors.oneBarBorderPartial | 0xFF3F51B5 | ✅ |\n| OneBar | Fill (full) | Color(0xFF13D31B) | extendedColors.oneBarFillFull | 0xFF13D31B | ✅ |\n| OneBar | Fill (empty) | Color(0xFFFF0000) | extendedColors.oneBarFillEmpty | 0xFFFF0000 | ✅ |\n\nBLOCKERS: None\n\nKEY DECISIONS:\n- Used MaterialTheme.colorScheme.scrim for black (0xFF000000) instead of creating custom \"black\" extended color - semantic meaning appropriate\n- Added oneBarFillEmpty to ExtendedColors rather than using MaterialTheme.colorScheme.error - original used bright red (0xFFFF0000) not Material 3's dark red error color\n- Wrapped entire VoxPlanApp in theme rather than individual screens - ensures consistent theme application throughout app\n\nVALIDATION:\n- Build successful: ./gradlew assembleDebug (9s)\n- No visual changes: All hex values match original exactly\n- Theme functional: ExtendedColors accessible via MaterialTheme.extendedColors.*\n- Agent coordination: Notified BlackStone, BluePond, GreenMountain, BlueMountain via Agent Mail","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:04:12.593488+07:00","updated_at":"2025-12-27T00:06:18.228372+07:00","closed_at":"2025-12-27T00:06:18.228372+07:00","close_reason":"MainScreen Material 3 migration complete. All 12 colors verified. Build passing. Theme wrapper fix applied."}
{"id":"VoxPlanApp-kgk","title":"Bug: Medal count triples after process death recovery","description":"When backgrounding app, killing process, and returning after timer would have completed a revolution, 3x the expected medals are awarded. E.g., should get 1x 10m medal but shows 3x 10m medals.","notes":"ROOT CAUSE IDENTIFIED:\nDouble-counting medals during process death recovery at FocusViewModel.kt:161-176.\n\nPROBLEM: Code calculates completeRevolutions from TOTAL elapsed time, then ADDS to existingMedals (which already contains medals for some revolutions).\n\nFIX: Change line 171 from:\n  val newMedalsEarned = completeRevolutions\nto:\n  val newMedalsEarned = (completeRevolutions - existingMedals.size).coerceAtLeast(0)\n\nCONFIDENCE: High - clear root cause with specific fix.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T16:21:21.352256+07:00","updated_at":"2025-12-26T16:48:47.138027+07:00","closed_at":"2025-12-26T16:48:47.138027+07:00","close_reason":"Fixed in FocusViewModel.kt: (1) Medal calculation now only counts new revolutions during process death, (2) startTimestamp corrected after restore, (3) Revolution change now awards correct medals based on elapsed time"}
{"id":"VoxPlanApp-m65","title":"Improve Progress screen colors using existing Goal screen palette","description":"Quick cosmetic improvement: Apply VoxPlan's existing color constants from Goal screen (PrimaryColor, PrimaryLightColor, SecondaryColor, etc.) to Progress screen cards to make it visually consistent with the rest of the app. Replace bland grays with branded colors. Small scope: just recolor existing UI, no Material 3 refactoring. This is a bridge solution before POST_MVP Material 3 migration (VoxPlanApp-0r0).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T20:48:29.963497+07:00","updated_at":"2025-12-28T19:24:26.009557+07:00","closed_at":"2025-12-28T19:24:26.009557+07:00","close_reason":"User manually applied color consistency between Progress and Goal screens using existing palette"}
{"id":"VoxPlanApp-mnz","title":"SharedViewModel singleton pattern may cause memory issues","description":"AppViewModelProvider.Factory creates SharedViewModel as a static singleton outside of proper lifecycle management. This can lead to: 1) Stale state after configuration changes, 2) Memory leaks if references persist. Consider using Hilt/Dagger scoping or viewModel() with activity scope.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T18:40:03.422375+07:00","updated_at":"2025-12-26T19:22:34.425306+07:00","closed_at":"2025-12-26T19:22:34.425306+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-n99","title":"Discrete task hours medals bank incorrectly as minutes","description":"When banking time from discrete task mode, MedalType.HOURS medals are treated as minutes. DISCIPLINE (1 hour) banks as 1 minute, EPIC_WIN (2 hours) banks as 2 minutes. The bankTime() function sums medal.value without converting hours to minutes.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T16:03:41.206494+07:00","updated_at":"2025-12-28T16:04:46.994911+07:00","closed_at":"2025-12-28T16:04:46.994911+07:00","close_reason":"Fixed: bankTime() and setupQuotaTracking() now convert MedalType.HOURS to minutes (value * 60) before summing. DISCIPLINE tasks now correctly bank 60 mins, EPIC_WIN banks 120 mins."}
{"id":"VoxPlanApp-p5c","title":"Improve medal display in Time Vault - show aggregated counts instead of individual medals","description":"","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T16:12:49.898683+07:00","updated_at":"2025-12-26T17:03:42.70746+07:00","closed_at":"2025-12-26T17:03:42.70746+07:00","close_reason":"Implemented medal aggregation: groupBy (value, type), show count below medal when \u003e 1, sorted by value descending"}
{"id":"VoxPlanApp-pnt","title":"Add Agent Mail workflow documentation to CLAUDE.md","description":"CLAUDE.md is missing critical information about Agent Mail integration - how agents should behave when registered with Agent Mail, including autonomous work pickup from beads issues and inter-agent communication protocols.","design":"Add new section 'Agent Mail Integration' to CLAUDE.md with:\n\n## Agent Mail Workflow\n\n**Registration Protocol:**\n- When agent registers with Agent Mail, check for open beads issues first\n- If beads issues exist: autonomously pick up and start work\n- If no beads issues: email Richard requesting work assignment\n\n**Autonomous Work Selection:**\n1. Run 'bd ready --json' to find available work (no blockers)\n2. Prioritize by: P0 \u003e P1 \u003e P2 \u003e P3 \u003e P4\n3. Select issue matching agent capabilities\n4. Notify other agents via Agent Mail: 'Starting work on [issue-id]'\n5. Update issue status: 'bd update [issue-id] --status=in_progress'\n6. Begin work following standard beads workflow\n\n**Inter-Agent Communication:**\n- Broadcast work start/completion to other agents\n- Check for related issues that might need coordination\n- Avoid duplicate work by checking agent activity\n- Use Agent Mail for handoffs between agents\n\n**Work Request Protocol (No Available Issues):**\n- Email Richard with:\n  - Current project state summary\n  - Completed work since last session\n  - Request for new work assignment\n  - Capabilities/specializations\n\n**Integration Points:**\n- Session start: Always check bd ready before requesting work\n- Work completion: Notify other agents of availability\n- Blocking issues: Email Richard for unblocking decisions","acceptance_criteria":"- Agent Mail section added to CLAUDE.md\n- Autonomous pickup workflow documented\n- Inter-agent communication protocol defined\n- Work request protocol specified\n- Integration with existing beads workflow clear","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:10:10.775714+07:00","updated_at":"2025-12-22T23:17:46.475022+07:00","closed_at":"2025-12-22T23:17:46.475022+07:00","close_reason":"Added Agent Mail Integration section to CLAUDE.md (lines 108-138) covering registration, autonomous work selection, inter-agent communication, and work request protocols."}
{"id":"VoxPlanApp-q6l","title":"FocusMode: SavedStateHandle restores stale state after process death","description":"**CRITICAL P0 BUG**: When app is backgrounded and process is killed, timer restoration shows state from BEFORE backgrounding. Timer 'goes backwards in time' - user sees old values, not current progress.\n\n**Evidence:**\n- User starts timer, runs for 2 minutes (shows 2:00)\n- User backgrounds app (home button)\n- Timer continues running in background, reaches 3 minutes\n- Process killed\n- App reopened: Timer shows 2:00 (WRONG - went backwards!)\n\n**Root Cause:**\nCurrent implementation has THREE fatal flaws:\n1. Uses System.currentTimeMillis() instead of SystemClock.elapsedRealtime() (can jump backwards when user changes system time)\n2. Tries to save currentTime (constantly changing value) instead of start timestamp (constant)\n3. SavedStateHandle writes AFTER Activity.onStop() don't persist to Bundle\n4. Auto-pauses on restoration instead of auto-continuing (user wants seamless timer)\n\n**Current Implementation Issues (Lines 103-385):**\n- Line 237: System.currentTimeMillis() ❌ (not monotonic)\n- Line 157: Saves currentTime (changes every second) ❌\n- Line 362-365: Periodic saves every 5 seconds (don't persist after onStop) ❌\n- Line 147-149: Auto-pauses on restoration ❌\n\n**Desired Behavior:**\nTimer continues seamlessly across process death. On restore:\n- Timer shows correct elapsed time (3:00 in example)\n- Medals awarded retroactively for time during process death\n- Timer keeps ticking as though nothing happened\n- User sees no interruption\n\n**Files Involved:**\n- app/src/main/java/com/voxplanapp/ui/focusmode/FocusViewModel.kt (primary changes)\n- Detailed plan: scratchpad/2025-12-22-140400_fix-savedstatehandle-stale-state/plan.md\n\n**Impact:**\nUsers lose focus session progress on process death. Timer resets to old values, medals vanish. Breaks core time tracking and gamification features.","design":"**CALCULATION-BASED APPROACH** using Android best practices:\n\n**Key Components:**\n\n1. **SystemClock.elapsedRealtime()** (not System.currentTimeMillis())\n   - Monotonic clock (never goes backwards)\n   - Immune to system time changes\n   - Official Android recommendation for elapsed time measurement\n\n2. **Save Start Timestamp** (not elapsed time)\n   - Constant value written ONCE when timer starts\n   - Saved BEFORE any backgrounding occurs\n   - Doesn't need periodic updates\n\n3. **Calculate Elapsed Time** on restoration\n   - elapsed = SystemClock.elapsedRealtime() - startTimestamp\n   - Includes time during process death\n   - Always accurate\n\n4. **Retroactive Medal Calculation**\n   - completeRevolutions = elapsed / clockFaceMins\n   - Award medals for each complete revolution\n   - remainder = elapsed % clockFaceMins (current progress)\n\n5. **Auto-Restart Timer** (seamless continuation)\n   - Timer state stays RUNNING\n   - Coroutine restarts with correct elapsed time\n   - No manual resume needed\n\n**Implementation Steps (11 total):**\n1. Import SystemClock\n2. Add KEY_START_TIMESTAMP constant\n3. Replace System.currentTimeMillis() with SystemClock.elapsedRealtime()\n4. Update timer job to read timestamp from SavedStateHandle\n5. Remove periodic saves (not needed - timestamp is constant)\n6. Modify restoreSavedState() with medal calculation logic\n7. Update saveCurrentState() (medals/settings only)\n8. Update pauseTimer() to save paused elapsed time\n9. Update clearSavedState() to include start timestamp\n10. Create unit tests\n11. Create instrumented tests\n\n**Why This Works:**\n- Start timestamp saved BEFORE backgrounding ✓\n- Timestamp is constant (no periodic writes needed) ✓\n- Calculation reconstructs elapsed time accurately ✓\n- Medals awarded retroactively ✓\n- Timer appears to never stop ✓\n\n**Reference:** scratchpad/2025-12-22-140400_fix-savedstatehandle-stale-state/plan.md (complete detailed implementation guide)","acceptance_criteria":"**Functional Success:**\n- [ ] Timer uses SystemClock.elapsedRealtime() (not System.currentTimeMillis())\n- [ ] Start timestamp saved to SavedStateHandle when timer starts\n- [ ] Process death restores correct elapsed time (includes time during death)\n- [ ] Medals awarded retroactively for complete revolutions during process death\n- [ ] Timer shows remainder time as current progress on clock face\n- [ ] Timer automatically continues on restoration (no manual resume)\n- [ ] Timer appears to 'never stop' from user perspective\n- [ ] System time changes don't affect timer (elapsedRealtime immunity)\n\n**Technical Success:**\n- [ ] All unit tests passing (FocusViewModelTest.kt - 6 tests)\n- [ ] All instrumented tests passing (FocusModeProcessDeathTest.kt - 3 tests)\n- [ ] No lint errors or warnings\n- [ ] No periodic saves during timer run (performance improvement)\n- [ ] Backward compatible with existing saved state\n\n**Test Scenarios:**\n- [ ] Start timer for 2 mins → background → kill process → reopen → shows 2:00 (RUNNING)\n- [ ] Start timer for 95 mins → kill process → reopen → shows 3 medals + 5 mins progress\n- [ ] Pause timer → kill process → reopen → stays paused with correct time\n- [ ] Change system time during timer → timer unaffected (monotonic clock)\n\n**Validation:**\n- Build succeeds: ./gradlew assembleDebug\n- Unit tests pass: ./gradlew test\n- Instrumented tests pass: ./gradlew connectedAndroidTest\n- Manual testing: adb shell am kill com.voxplanapp","notes":"COMPLETED:\n- Implemented SystemClock.elapsedRealtime() based timer (monotonic clock, immune to time adjustments)\n- Modified startTimer() to save start timestamp (constant) instead of elapsed time\n- Modified pauseTimer() to calculate and save paused elapsed time\n- Modified restoreSavedState() to:\n  * Calculate total elapsed time from saved timestamp\n  * Award medals retroactively for complete revolutions during process death\n  * Auto-restart timer with remainder time\n- Removed periodic saves from updateTimerState()\n- Removed lastSaveTime variable\n- Deleted Room-based FocusSession persistence (FocusSession.kt, DAO, Repository)\n- Removed FocusSession from AppDatabase entities and reverted to version 13\n- Removed focusSessionRepository from AppContainer and AppViewModelProvider\n- Updated FocusModeScreen to rely on automatic SavedStateHandle persistence\n- Build successful, all changes committed and pushed\n\nKEY DECISIONS:\n- Used SystemClock.elapsedRealtime() instead of System.currentTimeMillis() (monotonic vs wall-clock)\n- Calculation-based approach: save constant timestamp, calculate elapsed on demand\n- Retroactive medal awarding ensures users get credit for time elapsed during process death\n- Reverted database to version 13 (removed MIGRATION_13_14) since Room approach was wrong\n\nVERIFICATION:\nTimer now correctly:\n1. Saves start timestamp immediately when started\n2. Restores with accurate elapsed time after process death\n3. Awards medals for complete revolutions that occurred while backgrounded\n4. Auto-restarts with remainder time (seamless user experience)\n\n---\n[2025-12-26] Session Checkpoint - Additional Fixes\n\nCOMPLETED:\n- Fixed crash \"Illegal Capacity: -3\" in restoreSavedState() (FocusViewModel.kt:164-172)\n  - Root cause: startTimestamp resets after each medal, so completeRevolutions only represents NEW medals\n  - Changed medalDeficit calculation to newMedalsEarned (add new medals, don't subtract existing)\n  - Commit: 859c18a\n\n- Fixed bankTime() stopping timer (FocusViewModel.kt:656)\n  - Removed clearSavedState() call which killed timer by clearing KEY_START_TIMESTAMP\n  - Timer coroutine (line 243) reads timestamp every tick; null = exit\n\n- Fixed bankTime() not playing sound effect (FocusViewModel.kt:651-668)\n  - Moved sound/medal clearing outside coroutine (was async, never executing)\n  - Fixed goalId null check logic (else clause was unreachable)\n\nIN PROGRESS:\nTesting complete. Ready for manual verification on device.\n\nBLOCKERS: None\n\nKEY DECISIONS:\n- startTimestamp represents \"when CURRENT revolution started\" not \"session start\" - this is by design since timer auto-restarts after each medal\n- bankTime() should NOT clear saved state - user may want to bank mid-session and continue working\n- Timer job reads timestamp from savedStateHandle every tick - fragile design but functional","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-22T21:01:25.784243+07:00","updated_at":"2025-12-26T16:03:35.36504+07:00","closed_at":"2025-12-23T00:22:13.839538+07:00","close_reason":"Closed"}
{"id":"VoxPlanApp-s9h","title":"TodoDao getRootTodos query is broken","description":"TodoDao.kt:19-20 has query: SELECT * FROM TodoItem WHERE parentID = null. This SQL won't work correctly - 'null' is a string literal, not NULL. Should be: WHERE parentId IS NULL. This breaks the root-level goal fetching.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T18:40:15.399777+07:00","updated_at":"2025-12-26T19:22:34.421281+07:00","closed_at":"2025-12-26T19:22:34.421281+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-sdy","title":"FocusModeScreen.kt exceeds 1000 lines - needs decomposition","description":"FocusModeScreen.kt is 1048 lines, well over the 500-line threshold. Should be split into: timer components, medal display, dialogs, theme/typography. Location: ui/focusmode/FocusModeScreen.kt","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T18:39:12.414421+07:00","updated_at":"2025-12-26T19:22:34.428374+07:00","closed_at":"2025-12-26T19:22:34.428374+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-uxa","title":"Update Progress screen colors","description":"Update ProgressScreen color scheme: (1) current day to pale green (SecondaryColor), (2) title header to turquoise (TertiaryColor), (3) general background to light cyan tint. See plan: scratchpad/progress-screen-colors_26-Dec-25/plan.md","notes":"COMPLETED:\n- Added SecondaryColor and TertiaryColor imports to ProgressScreen.kt\n- Changed current day card background from Color(0xFFBAF7FF) to SecondaryColor (pale green matching subgoal lists) at line 174\n- Added TertiaryColor background with rounded corners (8dp) to title header Row at line 73\n- Added light cyan tint background Color(0xFFF0F8F8) to main Column at line 67\n- Build successful with no compilation errors\n\nIN PROGRESS: None\n\nBLOCKERS: None\n\nKEY DECISIONS:\n- Used TertiaryColor (0xFF82babd) for title background - only turquoise color in palette (user mentioned arrows but they don't have background)\n- Used Color(0xFFF0F8F8) for screen background - very light cyan/mint that complements existing palette without being too bold\n- Added RoundedCornerShape(8.dp) to title header for visual polish\n- Added proper padding to title header (16.dp all-sides + 8.dp bottom) for spacing\n\nFiles modified: ProgressScreen.kt (~10 lines changed)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T23:04:56.562131+07:00","updated_at":"2025-12-26T23:07:22.523615+07:00","closed_at":"2025-12-26T23:07:22.523615+07:00","close_reason":"Closed"}
{"id":"VoxPlanApp-xv3","title":"Remove or reference Architecture Overview from CLAUDE.md","description":"The Architecture Overview section in CLAUDE.md duplicates information already available in agent/context/project_context.md and agent/context/codebase_context.md. This creates maintenance burden and inconsistency risks.","design":"Replace detailed architecture content with:\n- Brief statement that architecture details are in context files\n- Direct references to specific context files (project_context.md, codebase_context.md)\n- Keep ONLY information that is Claude-specific workflow guidance, not general architecture\n- Verify all architectural info exists in context files first\n- If missing, add to context files, then remove from CLAUDE.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T23:08:39.74479+07:00","updated_at":"2025-12-22T23:20:17.138216+07:00","closed_at":"2025-12-22T23:20:17.138216+07:00","close_reason":"Architecture Overview section already replaced with 'Architecture \u0026 Codebase Reference' (lines 262-270) pointing to context files in agent/context/ directory."}
{"id":"VoxPlanApp-xyx","title":"MVP Release","description":"Core functionality release blocker. All features required for MVP must complete before this is closed. This epic blocks all POST_MVP work. When closed, unblocks: Material 3 migration, advanced features, polish items. Status: Track MVP completion criteria in notes.","status":"open","priority":0,"issue_type":"epic","created_at":"2025-12-26T20:41:15.8999+07:00","updated_at":"2025-12-26T20:41:15.8999+07:00"}
{"id":"VoxPlanApp-yia","title":"FocusViewModel.kt is 957 lines - needs refactoring","description":"FocusViewModel.kt at 957 lines is nearly double recommended size. Consider extracting: TimerManager, MedalManager, DiscreteTaskHandler, QuotaTracker as separate classes. Location: ui/focusmode/FocusViewModel.kt","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T18:39:13.54085+07:00","updated_at":"2025-12-26T19:22:34.427996+07:00","closed_at":"2025-12-26T19:22:34.427996+07:00","close_reason":"Code health skill needs refinement before creating actionable issues"}
{"id":"VoxPlanApp-yuo","title":"Material 3 Dark Mode: Sanity-check implementation plan before task breakdown","description":"PHASE 3: Full Material 3 dark mode migration. Add dark color schemes to theme, migrate all 10+ remaining screens (MainScreen, DailyScreen, FocusModeScreen, DaySchedule, GoalEditScreen, etc.), test everything in light/dark modes, accessibility validation. Plan location: scratchpad/2025-12-23-000113_material3-dark-mode/. DEPENDENCIES: VoxPlanApp-zhn (theme infrastructure) and VoxPlanApp-bln (Progress screen pilot) must complete first to validate incremental approach.","design":"The scratchpad contains three comprehensive documents:\n\n1. **plan.md** - Strategic overview\n   - Pattern analysis (3 anti-patterns in codebase)\n   - Recommended Material 3 approach\n   - External documentation references\n   - Integration impact analysis\n\n2. **implementation-plan-v2.md** - Tactical implementation\n   - Step-by-step migration guide\n   - Before/after code examples\n   - Dependency ordering\n   - Test strategy\n\n3. **color-analysis.md** - Color system design\n   - Material 3 color role mapping\n   - Accessibility analysis\n   - Extended color definitions (branding)\n\n**Review Focus Areas:**\n- Is the Material 3 migration approach sound?\n- Are the proposed color schemes accessible?\n- Is the migration strategy realistic (11+ files)?\n- Should we do incremental rollout or full migration?\n- Are extended colors correctly implemented?\n- Do we keep dynamic colors (Android 12+ wallpaper-based)?\n\n**Decision Points:**\n1. Full migration vs incremental (screen by screen)?\n2. Dynamic color support (true/false)?\n3. Extended color approach for branding?\n4. Timeline and resource allocation?","acceptance_criteria":"**Review Completed:**\n- [ ] Plan reviewed by technical lead or senior developer\n- [ ] Color schemes validated for WCAG AA compliance\n- [ ] Migration strategy approved (full vs incremental)\n- [ ] Dynamic color decision made (enable/disable)\n- [ ] Extended color approach validated\n- [ ] Timeline/resource estimate provided\n\n**Sanity Check Passed:**\n- [ ] No major architectural concerns identified\n- [ ] Approach aligns with Android best practices\n- [ ] Color accessibility verified\n- [ ] Breaking changes identified and acceptable\n- [ ] Plan ready for task breakdown\n\n**Next Action:**\n- [ ] Create detailed beads tasks from approved plan\n- [ ] Assign priority/ordering to implementation tasks\n- [ ] Begin implementation (separate issue)","notes":"**STATUS**: POST_MVP - Phase 3 of Material 3 migration, blocked by VoxPlanApp-zhn AND VoxPlanApp-bln AND VoxPlanApp-xyx\n\n**PLANNING COMPLETE**:\n- Comprehensive plan: scratchpad/2025-12-23-000113_material3-dark-mode/\n  - plan.md (100 lines - strategic overview)\n  - implementation-plan-v2.md (39KB - step-by-step guide)\n  - color-analysis.md (21KB - color system analysis)\n\n**DELIVERABLES**:\n- Add dark color schemes to ui/theme/Theme.kt\n- Migrate 10+ remaining screens (MainScreen, DailyScreen, FocusModeScreen, DaySchedule, GoalEditScreen, etc.)\n- Test all screens in light AND dark modes\n- Accessibility validation (WCAG AA compliance both modes)\n- Extended colors dark variants (medals, power bars)\n\n**BLOCKERS**:\n- VoxPlanApp-zhn (theme infrastructure must exist)\n- VoxPlanApp-bln (pilot migration validates approach)\n- VoxPlanApp-xyx (MVP Release) - POST_MVP work\n\n**KEY DECISIONS** (from plan review pending):\n- Full migration vs incremental screen-by-screen?\n- Dynamic color support (yes/no)?\n- Extended color approach validated by pilot?\n- Timeline based on Phase 1+2 learnings\n\n**NEXT STEPS** (after Phase 1+2 complete):\n1. Review pilot results (VoxPlanApp-bln)\n2. Sanity-check full migration plan\n3. Create detailed task breakdown\n4. Begin implementation\n\n**EFFORT**: TBD (depends on Phase 1+2 learnings)\n**CONFIDENCE**: Will be determined after pilot success","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-26T13:56:18.668864+07:00","updated_at":"2025-12-26T20:42:37.421788+07:00","dependencies":[{"issue_id":"VoxPlanApp-yuo","depends_on_id":"VoxPlanApp-zhn","type":"blocks","created_at":"2025-12-26T20:40:22.31833+07:00","created_by":"daemon"},{"issue_id":"VoxPlanApp-yuo","depends_on_id":"VoxPlanApp-bln","type":"blocks","created_at":"2025-12-26T20:40:22.587681+07:00","created_by":"daemon"}]}
{"id":"VoxPlanApp-zhn","title":"Enable Material 3 theme infrastructure (light mode)","description":"Make Theme.kt functional with VoxPlan colors (currently uses unused purple/pink defaults). Create ExtendedColors.kt for medals, power bars, custom UI. Enable MaterialTheme.colorScheme.* access app-wide. Light mode only (dark mode is Phase 3). PRP: .claude/PRPs/enable-material3-theme-light.md. Effort: 2.5 hours. Confidence: 8/10.","notes":"\n[2025-12-26 17:02 UTC] Session completion - MainScreen migration validated infrastructure\n\nADDITIONAL WORK THIS SESSION:\n- MainScreen migration (VoxPlanApp-ghk) validated Material 3 infrastructure\n- Discovered and fixed CRITICAL bug: VoxPlanApp() was not wrapped in VoxPlanAppTheme{}\n- Without theme wrapper, ALL MaterialTheme.extendedColors.* returned Color.Unspecified (transparent)\n- Fix: Added VoxPlanAppTheme wrapper in VoxPlanApp.kt:91\n\nINFRASTRUCTURE VALIDATION:\n✅ ExtendedColors system functional (after theme wrapper fix)\n✅ CompositionLocal pattern working correctly\n✅ Theme applies to all screens via VoxPlanNavHost\n✅ Build stable with theme enabled\n\nFILES ADDITIONALLY MODIFIED:\n- app/src/main/java/com/voxplanapp/navigation/VoxPlanApp.kt (added VoxPlanAppTheme wrapper)\n\nLESSONS LEARNED:\n- Theme infrastructure alone is insufficient - app must be wrapped in theme composable\n- Testing with actual screen migration (MainScreen) essential to validate infrastructure\n- Extended colors transparent without theme wrapper - not immediately obvious from build success","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-26T20:39:38.344099+07:00","updated_at":"2025-12-27T00:06:36.64139+07:00","closed_at":"2025-12-26T23:33:49.149908+07:00","close_reason":"Material 3 theme infrastructure enabled: Color.kt, Theme.kt, ExtendedColors.kt all functional. Build passing."}
